version: '3.8'

services:
  frontend:
    build:
      context: ./frontend
      labels:
        - "org.pseudolab.project=cert"
      args:
        VITE_API_BASE_URL: ${FRONTEND_EXTERNAL_API_URL:-https://backend:8000}
    ports:
      - "${FRONTEND_PORT}:80"
    restart: always

  backend:
    build:
      context: ./backend
      labels:
        - "org.pseudolab.project=cert"
    ports:
      - "${BACKEND_PORT}:8000"
    environment:
      - CORS_ORIGINS=${CORS_ORIGINS}
      - NOTION_API_KEY=${NOTION_API_KEY}
      - NOTION_CERT_DB_ID=${NOTION_CERT_DB_ID}
      - NOTION_PROJ_DB_ID=${NOTION_PROJ_DB_ID}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USERNAME=${SMTP_USERNAME}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
    restart: always
